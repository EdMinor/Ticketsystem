@model Ticketsystem.ViewModels.AdminTicketPanelViewModel

@{
    ViewData["Title"] = "Admin-Panel";
    string GetSortDirection(string order) => Model.SortOrder == order && Model.SortDirection == "asc" ? "desc" : "asc";
}

<h2>Admin-Panel: Alle Tickets</h2>

<div class="mb-3">
    <span>Sortieren nach: </span>
    <a asp-action="Index" asp-route-sortOrder="date" asp-route-sortDirection="@GetSortDirection("date")">Datum</a> |
    <a asp-action="Index" asp-route-sortOrder="status" asp-route-sortDirection="@GetSortDirection("status")">Status</a> |
    <a asp-action="Index" asp-route-sortOrder="user" asp-route-sortDirection="@GetSortDirection("user")">Benutzer</a>
</div>

@foreach (var group in Model.GroupedTickets.OrderByDescending(g => g.Key == "Hoch").ThenByDescending(g => g.Key == "Mittel").ThenByDescending(g => g.Key == "Niedrig").ThenBy(g => g.Key))
{
    <div class="mb-5">
        <h3>Priorität: @group.Key</h3>
        <table class="table">
            <thead>
                <tr>
                    <th>Titel</th>
                    <th>Beschreibung</th>
                    <th>Status</th>
                    <th>Priorität</th>
                    <th>Erstellt am</th>
                    <th>Erstellt von</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
            @foreach (var item in group.Value)
            {
                <tr>
                    <td>@item.Title</td>
                    <td>@item.Description</td>
                    <td>@item.Status</td>
                    <td>@item.Priority</td>
                    <td>@item.CreatedAt</td>
                    <td>@item.Creator?.UserName</td>
                    <td>
                        <a asp-controller="Ticket" asp-action="Edit" asp-route-id="@item.Id">Bearbeiten</a> |
                        <a asp-controller="Ticket" asp-action="Delete" asp-route-id="@item.Id">Löschen</a>
                    </td>
                </tr>
            }
            </tbody>
        </table>
    </div>
} 